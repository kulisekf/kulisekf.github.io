<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>src.main &mdash; Inscriptions-extractor 0.1.0 documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Inscriptions-extractor
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">src</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Inscriptions-extractor</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">src.main</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for src.main</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BufferedReader</span>
<span class="kn">import</span> <span class="nn">argparse</span>

<span class="c1">##přečte určitý počet bajtů, změní little-endian notaci na notmální</span>
<div class="viewcode-block" id="read_bytes"><a class="viewcode-back" href="../../src.html#src.main.read_bytes">[docs]</a><span class="k">def</span> <span class="nf">read_bytes</span><span class="p">(</span><span class="n">file</span><span class="p">:</span><span class="n">BufferedReader</span><span class="p">,</span><span class="n">n</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span><span class="n">byte_order</span><span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;L&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function reads the specified number of bytes and also changes the notation from little-endian to classic by default</span>

<span class="sd">        :param BufferedReader file: File to read data (bytes)</span>
<span class="sd">        :param int n: Number of bytes to read</span>
<span class="sd">        :param str byte_order: Specifies endianity - default &quot;L&quot; (little-endian)</span>

<span class="sd">        :returns: read bytes in big-endian (classical) notation format</span>

<span class="sd">        :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">byte_order</span> <span class="o">==</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">data</span></div>

<span class="c1">##bajt dat může značit více věcí - zde se rozhoduje, zda samotný bajt je výsledná požadovaná hodnota, či zda značí kolik následujících bajtů hodnotu obsahuje a až následně načte tuto hodnotu</span>
<div class="viewcode-block" id="read_varint"><a class="viewcode-back" href="../../src.html#src.main.read_varint">[docs]</a><span class="k">def</span> <span class="nf">read_varint</span><span class="p">(</span><span class="n">file</span><span class="p">:</span><span class="n">BufferedReader</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function reads one byte of data and decides whether this byte contains the searched data, or whether it contains information on how many subsequent bytes contain the searched data, which it then reads</span>

<span class="sd">        :param BufferedReader file: File to read data (bytes)</span>

<span class="sd">        :returns: value stored in one or more (2, 4, 8) bytes of data</span>

<span class="sd">        :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">bInt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">hex</span><span class="p">(),</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">bInt</span> <span class="o">&lt;</span> <span class="mi">253</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">bInt</span> <span class="o">==</span> <span class="mi">253</span><span class="p">:</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">bInt</span> <span class="o">==</span> <span class="mi">254</span><span class="p">:</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="k">if</span> <span class="n">bInt</span> <span class="o">==</span> <span class="mi">255</span><span class="p">:</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">c</span><span class="p">):</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="n">data</span>
    <span class="k">return</span> <span class="n">data</span></div>

<span class="c1">##funguje stejně, jako předchozí. S tím rozdílem, že je třeba uchovat a returnnout všechna data - použita pro výpočet transaction hashe</span>
<div class="viewcode-block" id="read_varint_transaction"><a class="viewcode-back" href="../../src.html#src.main.read_varint_transaction">[docs]</a><span class="k">def</span> <span class="nf">read_varint_transaction</span><span class="p">(</span><span class="n">file</span><span class="p">:</span><span class="n">BufferedReader</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function works in the same way as the read_variant() function, with the only difference that it needs to store and return all the data it works with - it is used, for example, to calculate the transaction hash</span>
<span class="sd">        </span>
<span class="sd">        :param BufferedReader file: File to read data (bytes)</span>

<span class="sd">        :returns: all the loaded data that the function worked with</span>

<span class="sd">        :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">tmpB</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="n">bInt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">hex</span><span class="p">(),</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">tmpHex</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">bInt</span> <span class="o">&lt;</span> <span class="mi">253</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">tmpHex</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">tmpB</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">bInt</span> <span class="o">==</span> <span class="mi">253</span><span class="p">:</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">bInt</span> <span class="o">==</span> <span class="mi">254</span><span class="p">:</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="k">if</span> <span class="n">bInt</span> <span class="o">==</span> <span class="mi">255</span><span class="p">:</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">c</span><span class="p">):</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">tmpHex</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="n">tmpHex</span>
    <span class="k">return</span> <span class="n">tmpHex</span><span class="p">,</span> <span class="n">tmpB</span></div>

<span class="c1">##z little-endian stringu udělá big-endian</span>
<div class="viewcode-block" id="reverse"><a class="viewcode-back" href="../../src.html#src.main.reverse">[docs]</a><span class="k">def</span> <span class="nf">reverse</span><span class="p">(</span><span class="nb">input</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function turns a little-endian string into big-endian        </span>
<span class="sd">        </span>
<span class="sd">        :param str input: Data sequence to change endianity</span>

<span class="sd">        :returns: Data with changed endianness</span>

<span class="sd">        :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">L</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">L</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Res</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">L</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="p">):</span>
            <span class="n">T</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="nb">input</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">Res</span> <span class="o">=</span> <span class="n">T</span> <span class="o">+</span> <span class="n">Res</span>
            <span class="n">T</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">return</span> <span class="n">Res</span></div>

<div class="viewcode-block" id="find_block"><a class="viewcode-back" href="../../src.html#src.main.find_block">[docs]</a><span class="k">def</span> <span class="nf">find_block</span><span class="p">(</span><span class="n">blockHash</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">DIR</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function goes through the blkXXXX.dat files and searches them for the required block based on the block hash value      </span>
<span class="sd">        </span>
<span class="sd">        :param str blockHash: Hash of the block to be found by the function - it is entered when starting the program within the console</span>
<span class="sd">        :param str DIR: The path to the folder that contains the blkXXXX.dat files (absolute/relative - preferred) - it is entered when starting the program within the console</span>

<span class="sd">        :returns: A list containing 2 values. The value at index 0 contains the name of the blkXXX.dat file in which the searched block is located, the value at index 1 contains the position in the file where the data of the searched block begins (even before the magic number and block size)</span>

<span class="sd">        :rtype: list of strings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">##nacte slozku a nasledne vsechny soubory do listu</span>
    <span class="n">fList</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">DIR</span><span class="p">)</span>
    <span class="n">fList</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">fList</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.dat&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;blk&#39;</span><span class="p">))]</span>
    <span class="n">fList</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1">##seřadí list sestupně - inscriptions budou spíše v novějších blocích</span>
    <span class="c1">## postupně projde všechny soubory</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">fList</span><span class="p">:</span>
        <span class="c1">##otevře daný soubor</span>
        <span class="n">nameSrc</span> <span class="o">=</span> <span class="n">i</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">DIR</span> <span class="o">+</span> <span class="n">nameSrc</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span>
        <span class="n">fSize</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">DIR</span> <span class="o">+</span> <span class="n">nameSrc</span><span class="p">)</span>
        <span class="n">zacatekBloku</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">velikostBloku</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1">#prochází soubor (každý blok), dokud nenarazí na konec souboru, nebo dokud nenajde hledaný blok - pokud najde, vrátí název souboru a pozici v něm, kde začíná hledaný blok</span>
        <span class="k">while</span> <span class="n">f</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span> <span class="o">!=</span> <span class="n">fSize</span> <span class="ow">and</span> <span class="n">velikostBloku</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="c1">#velikost bloku pro to, že poslední soubor (ten do kterého se aktuálně zapisují nové bloky) mi to bez tohoto pravidla procházelo i po přečtení nejaktuálnějšího bloku - jednoduše to skákalo po 8 bajtech</span>
            <span class="n">zacatekBloku</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
            <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">zacatekBloku</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="c1">##přeskočí magic number            </span>
            <span class="n">velikostBloku</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">read_bytes</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">base</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span><span class="c1">##načte velikost bloku - konvertovaná do bajtů</span>
            <span class="n">hlavickaBloku</span> <span class="o">=</span> <span class="n">read_bytes</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">)</span>
            <span class="n">hlavickaBlokuHash</span> <span class="o">=</span> <span class="n">hash_of_data</span><span class="p">(</span><span class="n">hlavickaBloku</span><span class="p">)</span> <span class="c1">#vypočítá hash nalezeného bloku</span>
            <span class="k">if</span> <span class="n">hlavickaBlokuHash</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">blockHash</span><span class="p">):</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">zacatekBloku</span><span class="p">)]</span>
            <span class="n">taproot_activated_block</span><span class="p">(</span><span class="n">hlavickaBlokuHash</span><span class="p">)</span> <span class="c1">#ověří, zda nebyl dosažen aktivační Taproot blok - pokud ano zastaví program</span>
            <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">velikostBloku</span> <span class="o">+</span> <span class="n">zacatekBloku</span> <span class="o">+</span> <span class="mi">8</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="c1">#přesun na (konec bloku + 1) - není to přímo začátek dalšího bloku, před ním je ještě magic number a velikost bloku</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>          
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: Non-exist block hash&quot;</span><span class="p">)</span> <span class="c1">##pokud prošel všechny soubory a požadovaný blockhash nenalezl - neexistuje</span></div>

<span class="c1">#vypočítá hash vstupních dat</span>
<div class="viewcode-block" id="hash_of_data"><a class="viewcode-back" href="../../src.html#src.main.hash_of_data">[docs]</a><span class="k">def</span> <span class="nf">hash_of_data</span><span class="p">(</span><span class="n">data</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function calculates a 2x sha256 hash of the input data     </span>
<span class="sd">        </span>
<span class="sd">        :param str data: input data whose hash is to be calculated</span>

<span class="sd">        :returns: 2x sha256 hash of input data</span>

<span class="sd">        :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">##vypocita hash bloku (jeho hlavicky - veliká 80 bajtů)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>        
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">data</span></div>

<span class="c1">#kontroluje, zda nalezený blok odpovídá prvnímu taproot bloku - díky taprootu jsou možné inscriptions</span>
<div class="viewcode-block" id="taproot_activated_block"><a class="viewcode-back" href="../../src.html#src.main.taproot_activated_block">[docs]</a><span class="k">def</span> <span class="nf">taproot_activated_block</span><span class="p">(</span><span class="n">blockHash</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function checks whether the found block corresponds to the first taproot block - inscriptions are possible thanks to taproot   </span>
<span class="sd">        </span>
<span class="sd">        :param str blockHash: block Hash to be compared with the hash of the activation taproot block</span>

<span class="sd">        :returns: None - if a matching block hash is found, the user is asked through the console whether the program should continue the evaluation or whether it should end (it is necessary to enter the value Y/N in the console)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">blockHash</span> <span class="o">==</span> <span class="s1">&#39;0000000000000000000687BCA986194DC2C1F949318629B44BB54EC0A94D8244&#39;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Block 709,632 reached (Taproot activated block), continue search? (Y/N)&quot;</span><span class="p">)</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">input</span><span class="p">())</span>
        <span class="k">while</span> <span class="n">stop</span> <span class="o">!=</span> <span class="s2">&quot;N&quot;</span> <span class="ow">and</span> <span class="n">stop</span> <span class="o">!=</span> <span class="s2">&quot;Y&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Wrong value was entered! continue search? (Y/N)</span><span class="se">\n</span><span class="s2"> -&gt;&quot;</span><span class="p">)</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">input</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">stop</span> <span class="o">==</span> <span class="s2">&quot;Y&quot;</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s2">&quot;Search stopped&quot;</span><span class="p">)</span></div>

<span class="c1">##pokusí se najít zadanou transakci. Pokus ji nenajde, vrátí text chyby, pokud ji najde a transakce obsahuje</span>
<span class="c1">#witness, vrátí lokaci witness a počet vstupů, pokud witness nebosahuje vrátí text chyby</span>
<div class="viewcode-block" id="find_transaction"><a class="viewcode-back" href="../../src.html#src.main.find_transaction">[docs]</a><span class="k">def</span> <span class="nf">find_transaction</span><span class="p">(</span><span class="n">fileName</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">zacatekBloku</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">txHash</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">DIR</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function goes through the individual transactions of the block and tries to find the specified transaction   </span>
<span class="sd">        </span>
<span class="sd">        :param str fileName: The name of the file where the transaction should be located</span>
<span class="sd">        :param str zacatekBloku: The position in the blkXXX.dat file where the data of the block in which the transaction should be located begins</span>
<span class="sd">        :param str txHash: Hash of the searched transaction - it is entered when starting the program within the console</span>
<span class="sd">        :param str DIR: The path to the folder that contains the blkXXXX.dat files (absolute/relative - preferred) - it is entered when starting the program within the console</span>

<span class="sd">        :returns: In case of successful transaction finding + if the transaction contains a witness part return list containing 2 values. The value at index 0 contains the position in the file where the witness part of the data of the searched transaction begins, the value at index 1 contains number of transaction inputs (for subsequent correct evaluation of the witness part)</span>

<span class="sd">        :rtype: list of strings    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">DIR</span> <span class="o">+</span> <span class="n">fileName</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="c1">##otevře správný soubor</span>
    <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">zacatekBloku</span><span class="p">)</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">80</span><span class="p">)</span> <span class="c1">##přeskočí na začátek bloku, následně za magicnumber a size a nakonec za celou hlavičku - následuje pro čtení hodnota tx count</span>
    <span class="n">txCount</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">read_varint</span><span class="p">(</span><span class="n">f</span><span class="p">),</span><span class="mi">16</span><span class="p">)</span><span class="c1">##zjisti mnozstvi transakci v bloku - převede z hexadecimal na decimal</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">txCount</span><span class="p">):</span>
        <span class="n">RawTX</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="n">read_bytes</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span> <span class="c1">## obsahuje TX version number</span>
        <span class="n">Witness</span><span class="p">,</span> <span class="n">inCount</span><span class="p">,</span> <span class="n">tmpHex</span> <span class="o">=</span> <span class="n">tx_in_count</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="c1">##zjistí počet vstupů do transakce, vyhodnotí případný segwit flag a zároveň vrátí i hodnotu pro RawTX</span>
        <span class="n">RawTX</span> <span class="o">+=</span> <span class="n">reverse</span><span class="p">(</span><span class="n">tmpHex</span><span class="p">)</span>

        <span class="c1">## projdou se všechny vstupy a přidají se do RawTX</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">inCount</span><span class="p">):</span>
            <span class="n">RawTX</span> <span class="o">+=</span> <span class="n">read_tx_in</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="c1">## zde se zjišťuje počet outputů</span>
        <span class="n">tmpHex</span><span class="p">,</span> <span class="n">tmpB</span> <span class="o">=</span> <span class="n">read_varint_transaction</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">outputCount</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmpHex</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">RawTX</span> <span class="o">+=</span> <span class="n">reverse</span><span class="p">(</span><span class="n">tmpHex</span> <span class="o">+</span> <span class="n">tmpB</span><span class="p">)</span>

        <span class="c1">## projdou se všechny výstupy transakce</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">outputCount</span><span class="p">):</span>
            <span class="n">RawTX</span> <span class="o">+=</span> <span class="n">read_tx_out</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="n">zacatekWitness</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
        <span class="c1">##postupně přeskočí celou witness část transakce</span>
        <span class="k">if</span> <span class="n">Witness</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">skip_witness</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">inCount</span><span class="p">)</span>

        <span class="n">RawTX</span> <span class="o">+=</span> <span class="n">reverse</span><span class="p">(</span><span class="n">read_bytes</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span> <span class="c1">##hodnota Lock time, reversnutá a přidaná</span>
        <span class="n">RawTXHash</span> <span class="o">=</span> <span class="n">hash_of_data</span><span class="p">(</span><span class="n">RawTX</span><span class="p">)</span>        <span class="c1">## z Rawtx udělá její hash</span>

        <span class="c1">## zjistí, zda nalezl správnou transakci</span>
        <span class="k">if</span> <span class="n">txHash</span> <span class="o">==</span> <span class="n">RawTXHash</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">Witness</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">zacatekWitness</span><span class="p">,</span> <span class="n">inCount</span><span class="p">]</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: The entered transaction does not contain the witness part&quot;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: Non-exist TX hash in this block&quot;</span><span class="p">)</span></div>

<span class="c1">##zjistí počet vstupů do transakce, vyhodnotí případný segwit flag a zároveň vrátí i hodnotu pro RawTX</span>
<div class="viewcode-block" id="tx_in_count"><a class="viewcode-back" href="../../src.html#src.main.tx_in_count">[docs]</a><span class="k">def</span> <span class="nf">tx_in_count</span><span class="p">(</span><span class="n">f</span><span class="p">:</span><span class="n">BufferedReader</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">object</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function detects the number of inputs to the transaction, evaluates any segwit flag, and at the same time returns a value for building RawTX  </span>
<span class="sd">        </span>
<span class="sd">        :param f BufferedReader: File to read data (bytes)</span>

<span class="sd">        :returns: Returns a total of 3 values - 1. value is witness identifier (True/False); 2. value is number of inputs; 3. value is all the loaded data that the function worked with</span>

<span class="sd">        :rtype: bool, int, str </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Witness</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">tmpB</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="n">bInt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">hex</span><span class="p">(),</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">tmpHex</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">bInt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">tmpB</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">bInt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">hex</span><span class="p">(),</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">tmpB</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">Witness</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">bInt</span> <span class="o">&lt;</span> <span class="mi">253</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">tmpHex</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">bInt</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">tmpB</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">bInt</span> <span class="o">==</span> <span class="mi">253</span><span class="p">:</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">if</span> <span class="n">bInt</span> <span class="o">==</span> <span class="mi">254</span><span class="p">:</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="k">if</span> <span class="n">bInt</span> <span class="o">==</span> <span class="mi">255</span><span class="p">:</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">c</span><span class="p">):</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="n">tmpHex</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="n">tmpHex</span>
        
    <span class="n">inCount</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmpHex</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span><span class="c1">## obsahuje počet vstupů do transakce</span>
    
    <span class="n">tmpHex</span> <span class="o">=</span> <span class="n">tmpHex</span> <span class="o">+</span> <span class="n">tmpB</span>
    <span class="k">return</span> <span class="n">Witness</span><span class="p">,</span> <span class="n">inCount</span><span class="p">,</span> <span class="n">tmpHex</span></div>

<span class="c1">#přeskočí celou witness část dat při průchodu transakcí</span>
<div class="viewcode-block" id="skip_witness"><a class="viewcode-back" href="../../src.html#src.main.skip_witness">[docs]</a><span class="k">def</span> <span class="nf">skip_witness</span><span class="p">(</span><span class="n">f</span><span class="p">:</span><span class="n">BufferedReader</span><span class="p">,</span> <span class="n">inCount</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function value is all read and skips the entire witness part of the data when passing the transactional data with which the function worked  </span>
<span class="sd">        </span>
<span class="sd">        :param f BufferedReader: The file from which the data is read</span>
<span class="sd">        :param int inCount: Number of transaction inputs - for the witness part to pass correctly, it is necessary to know how many inputs it contains data for</span>

<span class="sd">        :returns: None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">inCount</span><span class="p">):</span> <span class="c1">##pro každý vstup</span>
        <span class="n">WitnessLength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">read_varint</span><span class="p">(</span><span class="n">f</span><span class="p">),</span><span class="mi">16</span><span class="p">)</span> <span class="c1">##zjistí počet prvků ve witness</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">WitnessLength</span><span class="p">):</span> <span class="c1">#pro každý prvek ve witness</span>
            <span class="n">WitnessItemLength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">read_varint</span><span class="p">(</span><span class="n">f</span><span class="p">),</span><span class="mi">16</span><span class="p">)</span> <span class="c1">##zjistí délku prvku</span>
            <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">WitnessItemLength</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="c1">##přeskočí celý witness prvek</span></div>

<span class="c1">#projde celý vstup transakce a vrátí jeho data pro použití v RawTX</span>
<div class="viewcode-block" id="read_tx_in"><a class="viewcode-back" href="../../src.html#src.main.read_tx_in">[docs]</a><span class="k">def</span> <span class="nf">read_tx_in</span><span class="p">(</span><span class="n">f</span><span class="p">:</span><span class="n">BufferedReader</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function loops through the entire transaction input and returns its data for build RawTX  </span>
<span class="sd">        </span>
<span class="sd">        :param f BufferedReader: File to read data (bytes)</span>

<span class="sd">        :returns: used for build RawTX</span>

<span class="sd">        :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tmpHex</span> <span class="o">=</span> <span class="n">read_bytes</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="mi">32</span><span class="p">)</span> <span class="c1">## txid (hash) předchozí tx</span>
    <span class="n">RawTX</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="n">tmpHex</span><span class="p">)</span>
    
    <span class="n">tmpHex</span> <span class="o">=</span> <span class="n">read_bytes</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="c1">## index výstupu předchozí tx            </span>
    <span class="n">RawTX</span> <span class="o">+=</span> <span class="n">reverse</span><span class="p">(</span><span class="n">tmpHex</span><span class="p">)</span>
    <span class="c1">##v předsegwitových tx je na tomto místě podpisový skript, zde prázdné - je ve witness -&gt; načte tuto část</span>
    <span class="n">tmpHex</span><span class="p">,</span> <span class="n">tmpB</span> <span class="o">=</span> <span class="n">read_varint_transaction</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        
    <span class="n">scriptLength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmpHex</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">tmpHex</span> <span class="o">=</span> <span class="n">tmpHex</span> <span class="o">+</span> <span class="n">tmpB</span>
    <span class="n">RawTX</span> <span class="o">+=</span> <span class="n">reverse</span><span class="p">(</span><span class="n">tmpHex</span><span class="p">)</span>
    <span class="n">tmpHex</span> <span class="o">=</span> <span class="n">read_bytes</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">scriptLength</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">)</span>
    <span class="n">RawTX</span> <span class="o">+=</span> <span class="n">tmpHex</span>
    <span class="c1">## sequence - časový zámek/RBF</span>
    <span class="n">tmpHex</span> <span class="o">=</span> <span class="n">read_bytes</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">)</span>
    <span class="n">RawTX</span> <span class="o">+=</span> <span class="n">tmpHex</span>
    <span class="k">return</span> <span class="n">RawTX</span></div>

<div class="viewcode-block" id="read_tx_out"><a class="viewcode-back" href="../../src.html#src.main.read_tx_out">[docs]</a><span class="k">def</span> <span class="nf">read_tx_out</span><span class="p">(</span><span class="n">f</span><span class="p">:</span><span class="n">BufferedReader</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function loops through the entire transaction output and returns its data for build RawTX  </span>
<span class="sd">        </span>
<span class="sd">        :param f BufferedReader: File to read data (bytes)</span>

<span class="sd">        :returns: used for build RawTX</span>

<span class="sd">        :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">## value v sat</span>
    <span class="n">tmpHex</span> <span class="o">=</span> <span class="n">read_bytes</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
    <span class="c1">## následující část čte scriptPubKey</span>
    <span class="n">RawTX</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="n">tmpHex</span><span class="p">)</span>
    <span class="n">tmpHex</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">tmpHex</span><span class="p">,</span> <span class="n">tmpB</span> <span class="o">=</span> <span class="n">read_varint_transaction</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="n">scriptLength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmpHex</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">tmpHex</span> <span class="o">=</span> <span class="n">tmpHex</span> <span class="o">+</span> <span class="n">tmpB</span>
    <span class="n">RawTX</span> <span class="o">=</span> <span class="n">RawTX</span> <span class="o">+</span> <span class="n">reverse</span><span class="p">(</span><span class="n">tmpHex</span><span class="p">)</span>
    <span class="n">tmpHex</span> <span class="o">=</span> <span class="n">read_bytes</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">scriptLength</span><span class="p">,</span><span class="s1">&#39;B&#39;</span><span class="p">)</span>
    <span class="n">RawTX</span> <span class="o">=</span> <span class="n">RawTX</span> <span class="o">+</span> <span class="n">tmpHex</span>
    <span class="n">tmpHex</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">return</span> <span class="n">RawTX</span></div>

<span class="c1">##projde všechna witness transakce, pokusí se najít správné - rozhoduje dle prefixu odpovídajícímu inscription</span>
<div class="viewcode-block" id="find_inscription"><a class="viewcode-back" href="../../src.html#src.main.find_inscription">[docs]</a><span class="k">def</span> <span class="nf">find_inscription</span><span class="p">(</span><span class="n">fileName</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">zacatekWitness</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">inCount</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">DIR</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function loops through the entire transaction output and returns its data for build RawTX  </span>
<span class="sd">        </span>
<span class="sd">        :param f BufferedReader: File to read data (bytes)</span>

<span class="sd">        :returns: used for build RawTX</span>

<span class="sd">        :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">DIR</span> <span class="o">+</span> <span class="n">fileName</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">zacatekWitness</span><span class="p">)</span>
    <span class="n">inscription</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="c1">## pro každý ze vstupů - bude nejspíše 1, ale sichr je sichr</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">inCount</span><span class="p">):</span>
        <span class="n">tmpHex</span> <span class="o">=</span> <span class="n">read_varint</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="c1">#přeskočí první část witness - nepotřebuji, myslím že pubkey</span>
        <span class="n">WitnessItemLength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">read_varint</span><span class="p">(</span><span class="n">f</span><span class="p">),</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">WitnessItemLength</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1">##načtu 2. část witness</span>
        <span class="n">tmpHex</span> <span class="o">=</span> <span class="n">read_varint</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">WitnessItemLength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmpHex</span><span class="p">,</span><span class="mi">16</span><span class="p">)</span>
        <span class="n">tmpHex</span> <span class="o">=</span> <span class="n">reverse</span><span class="p">(</span><span class="n">read_bytes</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">WitnessItemLength</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">inscription</span> <span class="o">+=</span> <span class="n">tmpHex</span>
        <span class="n">tmpHex</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="n">inscription</span> <span class="o">=</span> <span class="n">inscription</span><span class="p">[</span><span class="mi">68</span><span class="p">:]</span> <span class="c1">##smažu část witness - signature a OP_CHECKSIG</span>
        
        <span class="c1">## z ničeho nic se to objevilo, zatím jsem nenašel co to má být, tak prostě přeskakuji</span>
        <span class="k">if</span> <span class="n">inscription</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;06&quot;</span><span class="p">:</span>
            <span class="n">inscription</span> <span class="o">=</span> <span class="n">inscription</span><span class="p">[</span><span class="mi">16</span><span class="p">:]</span>
        <span class="c1">## zjistí, zda se jedná o inscriptions - shodný prefix</span>
        <span class="k">if</span> <span class="n">inscription</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">16</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;0063036F72640101&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">extract_inscription</span><span class="p">(</span><span class="n">inscription</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: Transaction does not contain inscription&quot;</span><span class="p">)</span></div>

<span class="c1">##pokud se ve witness datech podařilo najít část s inscriptions, projde zbytek a vyextrahuje čistě inscription data zde uložená</span>
<div class="viewcode-block" id="extract_inscription"><a class="viewcode-back" href="../../src.html#src.main.extract_inscription">[docs]</a><span class="k">def</span> <span class="nf">extract_inscription</span><span class="p">(</span><span class="n">inscription</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function is used if a part with inscriptions was found in the witness - it goes through the rest and extracts purely the inscription data stored here</span>
<span class="sd">        </span>
<span class="sd">        :param inscription str: string with the witness data part that contains the inscription data</span>

<span class="sd">        :returns: A list containing 2 values. The value at index 0 contains type of inscription data, the value at index 1 contains the inscription data itself</span>

<span class="sd">        :rtype: list of strings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">inscription</span> <span class="o">=</span> <span class="n">inscription</span><span class="p">[</span><span class="mi">16</span><span class="p">:]</span> <span class="c1">##odstraním prefix</span>
    <span class="n">typeLength</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">inscription</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">base</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="mi">2</span> <span class="c1">##zjistim si délku popisu typu obsahu</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="n">inscription</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="n">typeLength</span><span class="p">]</span>  <span class="c1">##nactu typ obsahu</span>
    <span class="n">inscription</span> <span class="o">=</span> <span class="n">inscription</span><span class="p">[</span><span class="n">typeLength</span><span class="o">+</span><span class="mi">2</span><span class="p">:]</span> <span class="c1">##ostranim typ obsahu</span>
    <span class="n">inscription_final</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="c1">##dokud nebude string obsahující inscriptions data prázdný - kromě OP_ENDIF na konci, to tam nechávám</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">inscription</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1">##zjistí kolik bajtů obsahuje data, bajty s hodnotou odstraní a bajty s daty přesune</span>
        <span class="n">segmentLength</span><span class="p">,</span> <span class="n">byteOut</span> <span class="o">=</span> <span class="n">length_reader</span><span class="p">(</span><span class="n">inscription</span><span class="p">)</span>
        <span class="n">inscription</span> <span class="o">=</span> <span class="n">inscription</span><span class="p">[</span><span class="n">byteOut</span><span class="p">:]</span>
        <span class="n">inscription_final</span> <span class="o">+=</span> <span class="n">inscription</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">segmentLength</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">inscription</span> <span class="o">=</span> <span class="n">inscription</span><span class="p">[</span><span class="n">segmentLength</span><span class="o">*</span><span class="mi">2</span><span class="p">:]</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">type</span><span class="p">,</span> <span class="n">inscription_final</span><span class="p">]</span></div>

<span class="c1">##zjistí, kolik bajtů obsahuje data + kolik bajtů nese tuto informaci</span>
<div class="viewcode-block" id="length_reader"><a class="viewcode-back" href="../../src.html#src.main.length_reader">[docs]</a><span class="k">def</span> <span class="nf">length_reader</span><span class="p">(</span><span class="n">inscription</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function is used to read the inscription data from the witness - it finds out how many bytes the data contains + how many bytes carry this information</span>
<span class="sd">        </span>
<span class="sd">        :param inscription str: string with the witness data part that contains the inscription data</span>

<span class="sd">        :returns: A list containing 2 values. The value at index 0 contains number of bytes that indicated, how many bytes contain inscription data in hex format, the value at index 1 contains the number of bytes that carry information on how many subsequent bytes contain inscription data (these bytes do not contain the inscription data itself, they are skipped when extracting the inscription)</span>

<span class="sd">        :rtype: list of int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">inscription</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="s1">&#39;4C&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="n">inscription</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]),</span> <span class="mi">16</span><span class="p">),</span> <span class="mi">4</span>
    <span class="k">elif</span> <span class="n">b</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="s1">&#39;4D&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="n">inscription</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">6</span><span class="p">]),</span> <span class="mi">16</span><span class="p">),</span> <span class="mi">6</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="n">inscription</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]),</span> <span class="mi">16</span><span class="p">),</span> <span class="mi">2</span></div>

<span class="c1">##zjistí typ inscriptions a uloží ho do správného souboru</span>
<div class="viewcode-block" id="save_inscription"><a class="viewcode-back" href="../../src.html#src.main.save_inscription">[docs]</a><span class="k">def</span> <span class="nf">save_inscription</span><span class="p">(</span><span class="nb">type</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">inscription</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">result_dir</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function evaluates the inscription type and saves it to the correct file</span>
<span class="sd">        </span>
<span class="sd">        :param type str: Data inscription type - the file type for data storage depends on it</span>
<span class="sd">        :param inscription str: Inscription data to save to file</span>
<span class="sd">        :param result_dir str: The path to the folder where the inscription file should be saved (absolute/relative - preferred) - entered when starting the program in the console</span>

<span class="sd">        :returns: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="s1">&#39;6170706C69636174696F6E2F6A617661736372697074&#39;</span><span class="p">):</span> <span class="c1">#application/javascript</span>
        <span class="n">save_file</span><span class="p">(</span><span class="s2">&quot;js&quot;</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">inscription</span><span class="p">),</span> <span class="n">result_dir</span><span class="p">)</span> 
    <span class="k">if</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="s1">&#39;6170706C69636174696F6E2F6A736F6E&#39;</span><span class="p">):</span> <span class="c1">#application/json</span>
        <span class="n">save_file</span><span class="p">(</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">inscription</span><span class="p">),</span> <span class="n">result_dir</span><span class="p">)</span> 
    <span class="k">elif</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="s1">&#39;6170706C69636174696F6E2F706466&#39;</span><span class="p">):</span> <span class="c1">#application/pdf</span>
        <span class="n">save_file</span><span class="p">(</span><span class="s2">&quot;pdf&quot;</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">inscription</span><span class="p">),</span> <span class="n">result_dir</span><span class="p">)</span> 
    <span class="k">elif</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="s1">&#39;6170706C69636174696F6E2F7067702D7369676E6174757265&#39;</span><span class="p">):</span> <span class="c1">#application/pgp-signature</span>
        <span class="n">save_file</span><span class="p">(</span><span class="s2">&quot;sig&quot;</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">inscription</span><span class="p">),</span> <span class="n">result_dir</span><span class="p">)</span> 
    <span class="k">elif</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="s1">&#39;6170706C69636174696F6E2F79616D6C&#39;</span><span class="p">):</span> <span class="c1">#application/yaml</span>
        <span class="n">save_file</span><span class="p">(</span><span class="s2">&quot;yaml&quot;</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">inscription</span><span class="p">),</span> <span class="n">result_dir</span><span class="p">)</span> 
    <span class="k">elif</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="s1">&#39;617564696F2F666C6163&#39;</span><span class="p">):</span> <span class="c1">#audio/flac</span>
        <span class="n">save_file</span><span class="p">(</span><span class="s2">&quot;flac&quot;</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">inscription</span><span class="p">),</span> <span class="n">result_dir</span><span class="p">)</span> 
    <span class="k">elif</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="s1">&#39;617564696F2F6D706567&#39;</span><span class="p">):</span> <span class="c1">#audio/mpeg</span>
        <span class="n">save_file</span><span class="p">(</span><span class="s2">&quot;mpg&quot;</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">inscription</span><span class="p">),</span> <span class="n">result_dir</span><span class="p">)</span> 
    <span class="k">elif</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="s1">&#39;617564696F2F776176&#39;</span><span class="p">):</span> <span class="c1">#audio/wav</span>
        <span class="n">save_file</span><span class="p">(</span><span class="s2">&quot;wav&quot;</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">inscription</span><span class="p">),</span> <span class="n">result_dir</span><span class="p">)</span> 
    <span class="k">elif</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="s1">&#39;696D6167652F61706E67&#39;</span><span class="p">):</span> <span class="c1">#image/apng</span>
        <span class="n">save_file</span><span class="p">(</span><span class="s2">&quot;apng&quot;</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">inscription</span><span class="p">),</span> <span class="n">result_dir</span><span class="p">)</span> 
    <span class="k">elif</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="s1">&#39;696D6167652F61766966&#39;</span><span class="p">):</span> <span class="c1">#image/avif</span>
        <span class="n">save_file</span><span class="p">(</span><span class="s2">&quot;avif&quot;</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">inscription</span><span class="p">),</span> <span class="n">result_dir</span><span class="p">)</span> 
    <span class="k">elif</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="s1">&#39;696D6167652F676966&#39;</span><span class="p">):</span> <span class="c1">#image/gif</span>
        <span class="n">save_file</span><span class="p">(</span><span class="s2">&quot;gif&quot;</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">inscription</span><span class="p">),</span> <span class="n">result_dir</span><span class="p">)</span> 
    <span class="k">elif</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="s1">&#39;696D6167652F6A706567&#39;</span><span class="p">):</span> <span class="c1">#image/jpeg</span>
        <span class="n">save_file</span><span class="p">(</span><span class="s2">&quot;jpeg&quot;</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">inscription</span><span class="p">),</span> <span class="n">result_dir</span><span class="p">)</span> 
    <span class="k">elif</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="s1">&#39;696D6167652F6A7067&#39;</span><span class="p">):</span> <span class="c1">#image/jpg</span>
        <span class="n">save_file</span><span class="p">(</span><span class="s2">&quot;jpg&quot;</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">inscription</span><span class="p">),</span> <span class="n">result_dir</span><span class="p">)</span> 
    <span class="k">elif</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="s1">&#39;696D6167652F706E67&#39;</span><span class="p">):</span> <span class="c1">#image/png</span>
        <span class="n">save_file</span><span class="p">(</span><span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">inscription</span><span class="p">),</span> <span class="n">result_dir</span><span class="p">)</span> 
    <span class="k">elif</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="s1">&#39;696D6167652F7376672B786D6C&#39;</span><span class="p">):</span> <span class="c1">#image/svg+xml</span>
        <span class="n">save_file</span><span class="p">(</span><span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">inscription</span><span class="p">),</span> <span class="n">result_dir</span><span class="p">)</span> 
    <span class="k">elif</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="s1">&#39;696D6167652F77656270&#39;</span><span class="p">):</span> <span class="c1">#image/webp</span>
        <span class="n">save_file</span><span class="p">(</span><span class="s2">&quot;webp&quot;</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">inscription</span><span class="p">),</span> <span class="n">result_dir</span><span class="p">)</span> 
    <span class="k">elif</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="s1">&#39;6D6F64656C2F676C74662D62696E617279&#39;</span><span class="p">):</span> <span class="c1">#model/gltf-binary</span>
        <span class="n">save_file</span><span class="p">(</span><span class="s2">&quot;gltf&quot;</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">inscription</span><span class="p">),</span> <span class="n">result_dir</span><span class="p">)</span> 
    <span class="k">elif</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="s1">&#39;6D6F64656C2F73746C&#39;</span><span class="p">):</span> <span class="c1">#model/stl</span>
        <span class="n">save_file</span><span class="p">(</span><span class="s2">&quot;stl&quot;</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">inscription</span><span class="p">),</span> <span class="n">result_dir</span><span class="p">)</span> 
    <span class="k">elif</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="s1">&#39;746578742F68746D6C3B636861727365743D7574662D38&#39;</span><span class="p">):</span> <span class="c1">#text/html;charset=utf-8</span>
        <span class="n">save_file</span><span class="p">(</span><span class="s2">&quot;html&quot;</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">inscription</span><span class="p">),</span> <span class="n">result_dir</span><span class="p">)</span> 
    <span class="k">elif</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="s1">&#39;746578742F706C61696E3B636861727365743D7574662D38&#39;</span><span class="p">):</span> <span class="c1">#text/plain;charset=utf-8</span>
        <span class="n">save_file</span><span class="p">(</span><span class="s2">&quot;txt&quot;</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">inscription</span><span class="p">),</span> <span class="n">result_dir</span><span class="p">)</span> 
    <span class="k">elif</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="s1">&#39;766964656F2F6D7034&#39;</span><span class="p">):</span> <span class="c1">#video/mp4</span>
        <span class="n">save_file</span><span class="p">(</span><span class="s2">&quot;mp4&quot;</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">inscription</span><span class="p">),</span> <span class="n">result_dir</span><span class="p">)</span> 
    <span class="k">elif</span> <span class="nb">type</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="s1">&#39;766964656F2F7765626D&#39;</span><span class="p">):</span> <span class="c1">#video/webm</span>
        <span class="n">save_file</span><span class="p">(</span><span class="s2">&quot;webm&quot;</span><span class="p">,</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">inscription</span><span class="p">),</span> <span class="n">result_dir</span><span class="p">)</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="s2">&quot;!!!unknown type of content!!!</span><span class="se">\n\n</span><span class="s2">type: &quot;</span><span class="p">,</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">inscription data: &quot;</span> <span class="o">+</span> <span class="n">inscription</span><span class="p">,</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">)</span>
        <span class="n">save_file</span><span class="p">(</span><span class="s2">&quot;txt&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">result_dir</span><span class="p">)</span> </div>
    
<div class="viewcode-block" id="save_file"><a class="viewcode-back" href="../../src.html#src.main.save_file">[docs]</a><span class="k">def</span> <span class="nf">save_file</span><span class="p">(</span><span class="n">suffix</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">result_dir</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span><span class="o">-&gt;</span><span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function saves the file containing the inscription</span>
<span class="sd">        </span>
<span class="sd">        :param suffix str: Suffix of the file in which the data will be stored</span>
<span class="sd">        :param data str: Inscription data to save to file</span>
<span class="sd">        :param result_dir str: The path to the folder where the inscription file should be saved (absolute/relative - preferred) - entered when starting the program in the console</span>

<span class="sd">        :returns: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">result_dir</span> <span class="o">+</span> <span class="s1">&#39;/inscription.&#39;</span> <span class="o">+</span> <span class="n">suffix</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="what_to_find"><a class="viewcode-back" href="../../src.html#src.main.what_to_find">[docs]</a><span class="k">def</span> <span class="nf">what_to_find</span><span class="p">()</span><span class="o">-&gt;</span><span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function, using argparse, loads the necessary data entered into the terminal when the application is started and returns for their subsequent use</span>

<span class="sd">        :returns: A list containing 4 values. In this order - the block hash of the block that contains the inscription, the hash of the transaction that contains the inscription, the path to the folder that contains the blkXXXX.dat files and the path to the folder where the inscription is to be stored</span>

<span class="sd">        :rtype: list of strings</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Extract inscription from block&#39;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-blkHash&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;hash of block with inscription transaction (required)&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-txHash&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;transaction hash of transaction with inscription (required)&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-blkDir&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;./.bitcoin/blocks&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;path to the block folder (default: &#39;./.bitcoin/blocks&#39;)&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-resDir&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;path to the folder for file save (default: &#39;./&#39;)&quot;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">DIR</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">blkDir</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">blkHash</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">64</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: Wrong blkHash value was entered! The hash length does not conform to the standard&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">txHash</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">64</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: Wrong txHash value was entered! The hash length does not conform to the standard&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">args</span><span class="o">.</span><span class="n">blkHash</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">args</span><span class="o">.</span><span class="n">txHash</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">DIR</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">resDir</span><span class="p">]</span></div>
 
<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../src.html#src.main.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The main function, which sequentially calls individual sub-parts while the program is running. At the same time, exception catching is performed at this level</span>

<span class="sd">        :returns: None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">coordinates</span> <span class="o">=</span> <span class="n">what_to_find</span><span class="p">()</span> <span class="c1">##list blockhash, transaction hash</span>
        <span class="n">whereIsBlock</span> <span class="o">=</span> <span class="n">find_block</span><span class="p">(</span><span class="n">coordinates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coordinates</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="c1">## list nazev souboru .blk ve kterem je hlevany blok, pozice kde blok zacina (pred magicnumber a size)</span>
        <span class="n">whereIsTransactionWitness</span> <span class="o">=</span> <span class="n">find_transaction</span><span class="p">(</span><span class="n">whereIsBlock</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">whereIsBlock</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">coordinates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">coordinates</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="c1">##najde zacatek transakce</span>
        <span class="n">finalInscription</span> <span class="o">=</span> <span class="n">find_inscription</span><span class="p">(</span><span class="n">whereIsBlock</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">whereIsTransactionWitness</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">whereIsTransactionWitness</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">coordinates</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">save_inscription</span><span class="p">(</span><span class="n">finalInscription</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">finalInscription</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">coordinates</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Filip Kulíšek.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>